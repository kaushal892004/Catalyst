{% extends 'base.html' %}
{% block title %}
Profile - Catalyst
{% endblock %}
{% block content %}
<div class="flex justify-center items-center w-screen min-h-screen my-12">
    <!-- Profile Edit Section -->
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-8 transition-transform transform-gpu hover:scale-105 hover:shadow-2xl">
        <h3 class="text-2xl font-semibold text-gray-800 mb-6">Edit Profile</h3>

        <!-- Full Name -->
        <label for="editFullName" class="block text-sm font-medium text-gray-700">Full Name</label>
        <input type="text" id="editFullName"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="Enter your full name" value="{{ user.full_name }}">

        <!-- Email -->
        <label for="editEmail" class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" id="editEmail"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="Enter your email" value="{{ user.email }}">

        <!-- Location -->
        <label for="editLocation" class="block text-sm font-medium text-gray-700">Location</label>
        <input type="text" id="editLocation"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="Enter your location" value="{{ user.location }}">

        <!-- Desired Job Role -->
        <label for="editDesiredRole" class="block text-sm font-medium text-gray-700">Desired Job Role</label>
        <input type="text" id="editDesiredRole"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="e.g., Software Developer" value="{{ user.desired_role }}">

        <!-- Short Bio -->
        <label for="editBio" class="block text-sm font-medium text-gray-700">Short Bio</label>
        <textarea id="editBio"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="Tell us a little about yourself">{{ user.bio }}</textarea>

        <!-- Skills -->
        <label for="editSkills" class="block text-sm font-medium text-gray-700">Skills</label>
        <textarea id="editSkills"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-4"
            placeholder="List your skills separated by commas">{{ user.skills | join(', ') }}</textarea>

        <!-- Experience -->
        <label for="editExperience" class="block text-sm font-medium text-gray-700">Experience</label>
        <textarea id="editExperience"
            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 mb-6"
            placeholder="Describe your experience">{{ user.experience }}</textarea>

        <!-- Save Button -->
        <div class="flex justify-between">
            <button id="saveChangesBtn" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-full transition-transform transform-gpu hover:scale-105">Save Changes</button>
            <a href="{{ url_for('home') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-full transition-transform transform-gpu hover:scale-105">Back to Home</a>
        </div>
    </div>
</div>

<script>
    document.getElementById('saveChangesBtn').addEventListener('click', async () => {
        const fullName = document.getElementById('editFullName').value;
        const email = document.getElementById('editEmail').value;
        const location = document.getElementById('editLocation').value;
        const desiredRole = document.getElementById('editDesiredRole').value;
        const bio = document.getElementById('editBio').value;
        const skills = document.getElementById('editSkills').value.split(',').map(skill => skill.trim());
        const experience = document.getElementById('editExperience').value;

        const response = await fetch('/profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // 'X-CSRFToken': csrfToken // Removed CSRF token header
            },
            body: JSON.stringify({
                full_name: fullName,
                email: email,
                location: location,
                desired_role: desiredRole,
                bio: bio,
                skills: skills,
                experience: experience
            })
        });

        if (response.ok) {
            alert('Profile updated successfully!');
            window.location.href = "{{ url_for('home') }}";
        } else {
            alert('Error updating profile. Please try again.');
        }
    });
</script>
{% endblock %}
